# 超协体 Web 仪表盘 - 局域网访问故障排除

## 📊 当前状态检测

### ✅ 服务器状态（正常）
- **IP 地址**: 192.168.1.3
- **端口**: 3000
- **监听地址**: 0.0.0.0（所有地址）✅
- **macOS 防火墙**: 已关闭 ✅
- **服务状态**: 运行中 ✅

### ❓ 问题症状
- 本机访问正常：http://localhost:3000 ✅
- **局域网访问失败**：http://192.168.1.3:3000 ❌

---

## 🔍 快速诊断步骤

### 第一步：确认两台电脑在同一网络

**在另一台电脑上执行**：

#### Windows:
```cmd
ping 192.168.1.3
```

#### macOS/Linux:
```bash
ping 192.168.1.3
```

**期望结果**：
```
Reply from 192.168.1.3: bytes=32 time=2ms TTL=64
```

**如果失败**：
- ❌ `Request timeout` → 网络隔离（见解决方案1）
- ❌ `Destination host unreachable` → 不在同一网络

---

### 第二步：测试端口连通性

**在另一台电脑上执行**：

#### Windows（PowerShell）:
```powershell
Test-NetConnection -ComputerName 192.168.1.3 -Port 3000
```

#### macOS/Linux:
```bash
nc -zv 192.168.1.3 3000
# 或
telnet 192.168.1.3 3000
```

**期望结果**：
```
Connection to 192.168.1.3 3000 port [tcp/*] succeeded!
```

**如果失败**：见下方解决方案

---

## 🛠️ 解决方案

### 解决方案 1：路由器 AP 隔离（最常见）

**问题**：很多路由器默认开启 **AP 隔离**（也叫客户端隔离），防止同一 WiFi 下的设备互相访问。

**检查方法**：
1. 登录路由器管理界面（通常是 192.168.1.1 或 192.168.0.1）
2. 查找以下设置：
   - AP 隔离（AP Isolation）
   - 客户端隔离（Client Isolation）
   - 无线隔离（Wireless Isolation）
   - 访客网络模式（Guest Network Mode）

**解决方法**：
- ✅ **关闭** AP 隔离功能
- 或者两台电脑都连接到**非访客网络**

**常见路由器品牌设置路径**：

| 品牌 | 设置路径 |
|------|---------|
| **TP-Link** | 无线设置 → 无线高级设置 → AP 隔离 |
| **小米路由器** | 常用设置 → WiFi 设置 → 访客网络 → 关闭 |
| **华为路由器** | 更多功能 → 网络设置 → WiFi 设置 → AP 隔离 |
| **Apple AirPort** | 基站 → 无线 → 无线选项 → 访客网络 |

---

### 解决方案 2：macOS 防火墙（虽然显示关闭，但建议再确认）

**手动检查**：
```bash
# 系统偏好设置 → 安全性与隐私 → 防火墙
```

**或者明确允许 Node 的入站连接**：
```bash
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --add $(which node)
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --unblockapp $(which node)
```

---

### 解决方案 3：切换到手机热点测试

**测试步骤**：
1. 打开手机热点
2. 两台电脑都连接到手机热点
3. 在手机上查看已连接设备的 IP
4. 尝试访问：`http://<新IP>:3000`

**如果成功**：说明是路由器设置问题（AP 隔离）
**如果失败**：说明是服务器或电脑防火墙问题

---

### 解决方案 4：使用 VPN（推荐长期方案）

**适用场景**：
- 无法修改路由器设置
- 需要远程访问
- 更安全的连接方式

**推荐工具**：

#### Tailscale（最简单，免费）

**在本机（服务器）上安装**：
```bash
brew install tailscale
sudo tailscale up
```

**在另一台电脑上安装**：
- 下载：https://tailscale.com/download
- 安装并登录（使用相同账号）

**获取 Tailscale IP**：
```bash
tailscale ip -4
# 输出示例：100.64.1.2
```

**访问地址**：
```
http://100.64.1.2:3000
```

**优势**：
- ✅ 绕过路由器限制
- ✅ 支持远程访问（不在同一 WiFi 也能用）
- ✅ 加密连接
- ✅ 跨平台（Windows/macOS/Linux/iOS/Android）

---

### 解决方案 5：临时使用 ngrok（快速测试）

**适用场景**：快速临时分享，无需配置网络

**步骤**：

1. **安装 ngrok**：
```bash
brew install ngrok
```

2. **启动隧道**：
```bash
ngrok http 3000
```

3. **获取公网地址**：
```
Forwarding   https://abc123.ngrok.io -> http://localhost:3000
```

4. **分享地址**：
```
https://abc123.ngrok.io
```

**注意**：
- ⚠️ 任何人都能访问这个地址
- ⚠️ 免费版会话有时间限制
- ⚠️ 仅用于临时测试，不推荐长期使用

---

## 🎯 推荐解决顺序

### 立即尝试（5分钟）

**1. 检查 ping**：
```bash
# 在另一台电脑上
ping 192.168.1.3
```

**2. 如果 ping 不通** → 路由器 AP 隔离
   - 登录路由器关闭 AP 隔离
   - 或者使用手机热点测试

**3. 如果 ping 通但端口不通** → 防火墙
   - 在本机运行：
   ```bash
   sudo /usr/libexec/ApplicationFirewall/socketfilterfw --add $(which node)
   ```

### 长期方案（30分钟）

**安装 Tailscale**（强烈推荐）：
```bash
# 本机
brew install tailscale
sudo tailscale up

# 另一台电脑也安装 Tailscale

# 使用 Tailscale IP 访问
http://<tailscale-ip>:3000
```

---

## 🔧 实时诊断脚本

我为你创建了一个诊断脚本：

**在本机运行**：
```bash
cd ~/ClaudeWorkspace/supercoordination-mcp
chmod +x diagnose-network.sh
./diagnose-network.sh
```

**脚本会检测**：
- ✅ 服务器是否运行
- ✅ 当前 IP 地址
- ✅ 端口监听状态
- ✅ 防火墙状态
- ✅ 提供局域网访问地址

---

## 📱 在另一台电脑上的操作步骤

### Windows 用户：

1. **打开浏览器**
2. **输入地址**：`http://192.168.1.3:3000`
3. **如果失败，打开 PowerShell 测试**：
   ```powershell
   Test-NetConnection -ComputerName 192.168.1.3 -Port 3000
   ```

### macOS 用户：

1. **打开浏览器**
2. **输入地址**：`http://192.168.1.3:3000`
3. **如果失败，打开终端测试**：
   ```bash
   nc -zv 192.168.1.3 3000
   ```

### 手机用户：

1. **连接同一 WiFi**
2. **打开浏览器**
3. **输入地址**：`http://192.168.1.3:3000`

---

## ❓ 常见错误信息

| 错误信息 | 原因 | 解决方案 |
|---------|------|---------|
| `无法访问此网站` | 网络隔离 | 检查 AP 隔离 |
| `连接超时` | 防火墙/端口未开 | 允许 Node 入站 |
| `拒绝连接` | 服务器未运行 | 启动 MCP 服务器 |
| `找不到服务器` | IP 地址错误 | 确认 IP 地址 |

---

## 💡 快速验证清单

在本机运行以下命令，将结果截图给我：

```bash
# 1. 检查 IP
ifconfig | grep "inet " | grep -v "127.0.0.1"

# 2. 检查端口
lsof -nP -iTCP:3000 | grep LISTEN

# 3. 检查防火墙
/usr/libexec/ApplicationFirewall/socketfilterfw --getglobalstate

# 4. 测试本地访问
curl -s http://localhost:3000 | head -5

# 5. 测试局域网访问（在本机自己访问自己的局域网 IP）
curl -s http://192.168.1.3:3000 | head -5
```

---

**下一步操作**：

1. 先在**本机**测试局域网 IP 是否能访问：
   ```bash
   open http://192.168.1.3:3000
   ```

2. 如果本机也不能访问局域网 IP → 可能是网卡配置问题
3. 如果本机可以，另一台不行 → **99% 是路由器 AP 隔离**

需要我帮你创建诊断脚本吗？
