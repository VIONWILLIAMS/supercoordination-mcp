<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„å·¥ä½œå° - è¶…åä½“</title>
    <script src="/js/auth.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .topbar {
            background: white;
            border-radius: 16px;
            padding: 16px 24px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .topbar-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .username {
            font-weight: 600;
            color: #333;
        }

        .points {
            font-size: 13px;
            color: #666;
        }

        .points-value {
            color: #ffa726;
            font-weight: 600;
        }

        .btn-logout {
            padding: 8px 16px;
            background: #f5f5f5;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            color: #666;
            transition: all 0.3s;
        }

        .btn-logout:hover {
            background: #e0e0e0;
            color: #333;
        }

        /* ç½‘æ ¼å¸ƒå±€ */
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 1200px) {
            .grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        /* å¡ç‰‡æ ·å¼ */
        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-icon {
            font-size: 20px;
        }

        /* å¿«é€Ÿæ“ä½œå¡ç‰‡ */
        .quick-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .action-btn {
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
        }

        .action-icon {
            font-size: 24px;
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stat-card {
            text-align: center;
        }

        .stat-value {
            font-size: 36px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        /* åŠ è½½çŠ¶æ€ */
        .loading {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ä»»åŠ¡åˆ—è¡¨ */
        .task-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .task-item {
            padding: 16px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .task-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .task-meta {
            display: flex;
            gap: 12px;
            font-size: 12px;
            color: #666;
        }

        .task-status {
            padding: 2px 8px;
            background: #e3f2fd;
            color: #1976d2;
            border-radius: 4px;
            font-size: 11px;
        }

        .task-status.completed {
            background: #e8f5e9;
            color: #388e3c;
        }

        .task-status.in-progress {
            background: #fff3e0;
            color: #f57c00;
        }

        /* äº”è¡Œèƒ½é‡æ¡ */
        .wuxing-bar {
            margin-bottom: 12px;
        }

        .wuxing-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            font-size: 13px;
        }

        .wuxing-progress {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .wuxing-fill {
            height: 100%;
            transition: width 0.5s;
        }

        .wuxing-fire { background: linear-gradient(90deg, #ff6b6b, #ff2e63); }
        .wuxing-metal { background: linear-gradient(90deg, #ffd93d, #f9ca24); }
        .wuxing-wood { background: linear-gradient(90deg, #6bff92, #06d6a0); }
        .wuxing-water { background: linear-gradient(90deg, #00d9ff, #4facfe); }
        .wuxing-earth { background: linear-gradient(90deg, #c77dff, #9d4edd); }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <div class="topbar">
            <div class="topbar-left">
                <div class="logo">è¶…åä½“</div>
                <div class="user-info">
                    <div class="avatar" id="userAvatar">U</div>
                    <div class="user-details">
                        <div class="username" id="username">åŠ è½½ä¸­...</div>
                        <div class="points">
                            ç§¯åˆ†ï¼š<span class="points-value" id="pointsBalance">--</span>
                        </div>
                    </div>
                </div>
            </div>
            <button class="btn-logout" onclick="logout()">ç™»å‡º</button>
        </div>

        <!-- å¿«é€Ÿæ“ä½œåŒº -->
        <div class="grid">
            <div class="card">
                <div class="card-title">
                    <span class="card-icon">âš¡</span>
                    å¿«é€Ÿæ“ä½œ
                </div>
                <div class="quick-actions">
                    <button class="action-btn" onclick="createTaskDialog()">
                        <span class="action-icon">ğŸ“</span>
                        <span>åˆ›å»ºä»»åŠ¡</span>
                    </button>
                    <button class="action-btn" onclick="registerMemberDialog()">
                        <span class="action-icon">ğŸ‘¥</span>
                        <span>æ³¨å†Œæˆå‘˜</span>
                    </button>
                    <button class="action-btn" onclick="viewTeamDashboard()">
                        <span class="action-icon">ğŸ“Š</span>
                        <span>å›¢é˜Ÿçœ‹æ¿</span>
                    </button>
                    <button class="action-btn" onclick="checkWuxingBalance()">
                        <span class="action-icon">â˜¯ï¸</span>
                        <span>äº”è¡Œå¹³è¡¡</span>
                    </button>
                </div>
            </div>

            <!-- ç»Ÿè®¡æ•°æ® -->
            <div class="card stat-card">
                <div class="card-title">
                    <span class="card-icon">ğŸ“‹</span>
                    æˆ‘çš„ä»»åŠ¡
                </div>
                <div class="stat-value" id="myTaskCount">--</div>
                <div class="stat-label">è¿›è¡Œä¸­çš„ä»»åŠ¡</div>
            </div>

            <div class="card stat-card">
                <div class="card-title">
                    <span class="card-icon">ğŸ‘¥</span>
                    å›¢é˜Ÿæˆå‘˜
                </div>
                <div class="stat-value" id="memberCount">--</div>
                <div class="stat-label">å·²æ³¨å†Œæˆå‘˜</div>
            </div>
        </div>

        <!-- ä»»åŠ¡åˆ—è¡¨ & äº”è¡Œåˆ†æ -->
        <div class="grid">
            <div class="card" style="grid-column: span 2;">
                <div class="card-title">
                    <span class="card-icon">ğŸ“Œ</span>
                    æœ€è¿‘ä»»åŠ¡
                </div>
                <div id="taskList" class="task-list">
                    <div class="loading">
                        <div class="spinner"></div>
                        æ­£åœ¨åŠ è½½ä»»åŠ¡...
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">
                    <span class="card-icon">â˜¯ï¸</span>
                    äº”è¡Œèƒ½é‡
                </div>
                <div id="wuxingEnergy">
                    <div class="wuxing-bar">
                        <div class="wuxing-label">
                            <span>ğŸ”¥ ç«</span>
                            <span id="firePercent">20%</span>
                        </div>
                        <div class="wuxing-progress">
                            <div class="wuxing-fill wuxing-fire" id="fireFill" style="width: 20%"></div>
                        </div>
                    </div>
                    <div class="wuxing-bar">
                        <div class="wuxing-label">
                            <span>âš™ï¸ é‡‘</span>
                            <span id="metalPercent">20%</span>
                        </div>
                        <div class="wuxing-progress">
                            <div class="wuxing-fill wuxing-metal" id="metalFill" style="width: 20%"></div>
                        </div>
                    </div>
                    <div class="wuxing-bar">
                        <div class="wuxing-label">
                            <span>ğŸŒ³ æœ¨</span>
                            <span id="woodPercent">20%</span>
                        </div>
                        <div class="wuxing-progress">
                            <div class="wuxing-fill wuxing-wood" id="woodFill" style="width: 20%"></div>
                        </div>
                    </div>
                    <div class="wuxing-bar">
                        <div class="wuxing-label">
                            <span>ğŸ’§ æ°´</span>
                            <span id="waterPercent">20%</span>
                        </div>
                        <div class="wuxing-progress">
                            <div class="wuxing-fill wuxing-water" id="waterFill" style="width: 20%"></div>
                        </div>
                    </div>
                    <div class="wuxing-bar">
                        <div class="wuxing-label">
                            <span>ğŸ”ï¸ åœŸ</span>
                            <span id="earthPercent">20%</span>
                        </div>
                        <div class="wuxing-progress">
                            <div class="wuxing-fill wuxing-earth" id="earthFill" style="width: 20%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;

        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        if (!isLoggedIn()) {
            window.location.href = '/login.html';
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            await loadUserInfo();
            await loadDashboardData();
        });

        // åŠ è½½ç”¨æˆ·ä¿¡æ¯
        async function loadUserInfo() {
            const user = getUser();
            if (user) {
                document.getElementById('username').textContent = user.username;
                document.getElementById('pointsBalance').textContent = user.pointsBalance;
                document.getElementById('userAvatar').textContent = user.username.charAt(0).toUpperCase();
            }
        }

        // åŠ è½½ä»ªè¡¨ç›˜æ•°æ®
        async function loadDashboardData() {
            try {
                // TODO: è°ƒç”¨MCP APIè·å–ä»»åŠ¡å’Œæˆå‘˜æ•°æ®
                // æš‚æ—¶æ˜¾ç¤ºå ä½æ•°æ®
                document.getElementById('myTaskCount').textContent = '0';
                document.getElementById('memberCount').textContent = '0';

                document.getElementById('taskList').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“­</div>
                        <div>æš‚æ— ä»»åŠ¡</div>
                        <div style="font-size: 13px; margin-top: 8px;">ç‚¹å‡»"åˆ›å»ºä»»åŠ¡"å¼€å§‹åä½œ</div>
                    </div>
                `;
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
            }
        }

        // å¿«é€Ÿæ“ä½œå‡½æ•°
        function createTaskDialog() {
            alert('åˆ›å»ºä»»åŠ¡åŠŸèƒ½å¼€å‘ä¸­...\n\næç¤ºï¼šå½“å‰éœ€è¦é€šè¿‡MCPå·¥å…·è°ƒç”¨API');
        }

        function registerMemberDialog() {
            alert('æ³¨å†Œæˆå‘˜åŠŸèƒ½å¼€å‘ä¸­...\n\næç¤ºï¼šå½“å‰éœ€è¦é€šè¿‡MCPå·¥å…·è°ƒç”¨API');
        }

        function viewTeamDashboard() {
            alert('å›¢é˜Ÿçœ‹æ¿åŠŸèƒ½å¼€å‘ä¸­...\n\næç¤ºï¼šå°†å±•ç¤ºå›¢é˜Ÿåä½œæ•°æ®å¯è§†åŒ–');
        }

        function checkWuxingBalance() {
            alert('äº”è¡Œå¹³è¡¡åˆ†æåŠŸèƒ½å¼€å‘ä¸­...\n\næç¤ºï¼šå°†åˆ†æå›¢é˜Ÿäº”è¡Œèƒ½é‡åˆ†å¸ƒ');
        }
    </script>
</body>
</html>
