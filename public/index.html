<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HYPERCOLLAB_2077 // è¶…åä½“åä½œä¸­æ¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* èµ›åšæœ‹å…‹éœ“è™¹é…è‰² */
            --neon-blue: #00f3ff;
            --neon-pink: #ff2e97;
            --neon-purple: #b537f2;
            --neon-green: #39ff14;
            --neon-orange: #ff6a00;

            /* äº”è¡Œéœ“è™¹è‰² */
            --fire: #ff2e63;
            --metal: #ffd93d;
            --wood: #6bff92;
            --water: #00d9ff;
            --earth: #c77dff;

            /* èƒŒæ™¯ */
            --bg-dark: #0a0e27;
            --bg-darker: #050814;
            --bg-panel: rgba(10, 14, 39, 0.8);

            /* æ–‡å­— */
            --text-primary: #ffffff;
            --text-secondary: #8b9dc3;
            --text-dim: #4a5568;
        }

        body {
            font-family: 'Courier New', 'Consolas', monospace;
            background: var(--bg-darker);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* èµ›åšæœ‹å…‹ç½‘æ ¼èƒŒæ™¯ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                linear-gradient(rgba(0, 243, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 243, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 0;
        }

        /* æ‰«æçº¿æ•ˆæœ */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.1) 0px,
                rgba(0, 0, 0, 0.1) 1px,
                transparent 1px,
                transparent 2px
            );
            pointer-events: none;
            z-index: 1;
            opacity: 0.3;
        }

        .container {
            position: relative;
            z-index: 2;
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* å¤´éƒ¨ - èµ›åšæœ‹å…‹é£æ ¼ */
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 0;
            border-bottom: 2px solid var(--neon-blue);
            box-shadow: 0 2px 20px rgba(0, 243, 255, 0.3);
            position: relative;
        }

        h1 {
            font-size: 3rem;
            font-weight: bold;
            letter-spacing: 4px;
            text-transform: uppercase;
            color: var(--neon-blue);
            text-shadow:
                0 0 10px rgba(0, 243, 255, 0.8),
                0 0 20px rgba(0, 243, 255, 0.6),
                0 0 30px rgba(0, 243, 255, 0.4);
            animation: glitch 3s infinite;
            margin-bottom: 10px;
        }

        @keyframes glitch {
            0%, 90%, 100% { transform: translate(0); }
            92% { transform: translate(-2px, 2px); }
            94% { transform: translate(2px, -2px); }
            96% { transform: translate(-2px, -2px); }
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .status-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .status-item {
            background: var(--bg-panel);
            padding: 10px 20px;
            border-radius: 4px;
            border: 1px solid var(--neon-blue);
            box-shadow: 0 0 10px rgba(0, 243, 255, 0.3);
            transition: all 0.3s ease;
        }

        .status-item:hover {
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.6);
            transform: translateY(-2px);
        }

        .status-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        .status-healthy {
            background: var(--neon-green);
            box-shadow: 0 0 10px var(--neon-green);
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.6;
                transform: scale(1.2);
            }
        }

        /* ç»Ÿè®¡å¡ç‰‡ - éœ“è™¹å‘å…‰ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--bg-panel);
            padding: 30px;
            border-radius: 4px;
            border: 1px solid var(--neon-purple);
            box-shadow:
                0 0 20px rgba(181, 55, 242, 0.2),
                inset 0 0 20px rgba(181, 55, 242, 0.05);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent,
                rgba(181, 55, 242, 0.1),
                transparent
            );
            transform: rotate(45deg);
            transition: all 0.5s ease;
        }

        .stat-card:hover::before {
            left: 100%;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow:
                0 0 40px rgba(181, 55, 242, 0.5),
                inset 0 0 20px rgba(181, 55, 242, 0.1);
            border-color: var(--neon-pink);
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--neon-blue);
            text-shadow: 0 0 10px rgba(0, 243, 255, 0.5);
        }

        /* ä¸»å†…å®¹åŒº - åŒåˆ—å¸ƒå±€ */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        /* é¢æ¿ - éœ“è™¹è¾¹æ¡† */
        .panel {
            background: var(--bg-panel);
            border: 1px solid var(--neon-blue);
            border-radius: 4px;
            padding: 25px;
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(
                90deg,
                transparent,
                var(--neon-blue),
                transparent
            );
            animation: scan 3s linear infinite;
        }

        @keyframes scan {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 243, 255, 0.3);
        }

        .panel-title {
            font-size: 1.2rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--neon-blue);
            text-shadow: 0 0 10px rgba(0, 243, 255, 0.5);
        }

        .panel-badge {
            background: rgba(0, 243, 255, 0.1);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            color: var(--neon-blue);
            border: 1px solid var(--neon-blue);
        }

        /* æˆå‘˜å¡ç‰‡ - èµ›åšæœ‹å…‹é£æ ¼ */
        .member-card {
            background: rgba(10, 14, 39, 0.6);
            border: 1px solid rgba(107, 255, 146, 0.3);
            border-left: 3px solid var(--wood);
            border-radius: 4px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            position: relative;
        }

        .member-card:hover {
            background: rgba(10, 14, 39, 0.9);
            border-left-width: 5px;
            box-shadow:
                0 0 20px rgba(107, 255, 146, 0.3),
                inset 0 0 20px rgba(107, 255, 146, 0.05);
            transform: translateX(5px);
        }

        .member-name {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: var(--neon-green);
            text-shadow: 0 0 5px rgba(57, 255, 20, 0.5);
        }

        .skills {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 12px;
        }

        .skill-tag {
            background: rgba(0, 217, 255, 0.1);
            color: var(--water);
            padding: 4px 12px;
            border-radius: 3px;
            font-size: 0.75rem;
            border: 1px solid var(--water);
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }

        .skill-tag:hover {
            background: rgba(0, 217, 255, 0.2);
            box-shadow: 0 0 10px rgba(0, 217, 255, 0.5);
        }

        .wuxing-bar {
            display: flex;
            gap: 4px;
            margin-top: 12px;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .wuxing-segment {
            height: 100%;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .wuxing-segment::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.3),
                transparent
            );
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .wuxing-segment:hover {
            opacity: 1;
            transform: scaleY(1.2);
        }

        /* ä»»åŠ¡å¡ç‰‡ - éœ“è™¹è¾¹æ¡† */
        .task-card {
            background: rgba(10, 14, 39, 0.6);
            border: 1px solid rgba(255, 46, 151, 0.3);
            border-left: 3px solid var(--neon-pink);
            border-radius: 4px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            position: relative;
        }

        .task-card:hover {
            background: rgba(10, 14, 39, 0.9);
            border-left-width: 5px;
            box-shadow:
                0 0 20px rgba(255, 46, 151, 0.3),
                inset 0 0 20px rgba(255, 46, 151, 0.05);
            transform: translateX(5px);
        }

        .task-title {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: var(--neon-pink);
            text-shadow: 0 0 5px rgba(255, 46, 151, 0.5);
        }

        .task-meta {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-top: 12px;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 3px;
            font-size: 0.75rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 1px solid;
        }

        .status-pending {
            background: rgba(255, 211, 61, 0.1);
            color: var(--metal);
            border-color: var(--metal);
        }

        .status-in_progress {
            background: rgba(0, 217, 255, 0.1);
            color: var(--water);
            border-color: var(--water);
        }

        .status-completed {
            background: rgba(107, 255, 146, 0.1);
            color: var(--wood);
            border-color: var(--wood);
        }

        .priority-badge {
            padding: 4px 12px;
            border-radius: 3px;
            font-size: 0.75rem;
            font-weight: bold;
            border: 1px solid;
        }

        .priority-S {
            background: rgba(255, 46, 99, 0.1);
            color: var(--fire);
            border-color: var(--fire);
            box-shadow: 0 0 10px rgba(255, 46, 99, 0.3);
        }

        .priority-A {
            background: rgba(255, 106, 0, 0.1);
            color: var(--neon-orange);
            border-color: var(--neon-orange);
        }

        .priority-B {
            background: rgba(0, 217, 255, 0.1);
            color: var(--water);
            border-color: var(--water);
        }

        .priority-C {
            background: rgba(139, 157, 195, 0.1);
            color: var(--text-secondary);
            border-color: var(--text-secondary);
        }

        /* è¿›åº¦æ¡ - éœ“è™¹å‘å…‰ */
        .progress-bar {
            margin-top: 12px;
            height: 6px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 3px;
            overflow: hidden;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(
                90deg,
                var(--neon-blue),
                var(--neon-purple)
            );
            border-radius: 3px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(0, 243, 255, 0.8);
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.3),
                transparent
            );
            animation: progress-shimmer 2s infinite;
        }

        @keyframes progress-shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* äº”è¡Œèƒ½é‡å¹³è¡¡ - å¤§å‹éœ“è™¹å›¾è¡¨ */
        .wuxing-balance {
            grid-column: 1 / -1;
        }

        .wuxing-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .wuxing-grid {
                grid-template-columns: 1fr;
            }
        }

        .wuxing-item {
            text-align: center;
            padding: 20px;
            background: rgba(10, 14, 39, 0.6);
            border-radius: 4px;
            border: 1px solid;
            transition: all 0.3s ease;
            position: relative;
        }

        .wuxing-item:hover {
            transform: translateY(-10px);
            box-shadow: 0 0 30px currentColor;
        }

        .wuxing-item.fire {
            border-color: var(--fire);
        }

        .wuxing-item.metal {
            border-color: var(--metal);
        }

        .wuxing-item.wood {
            border-color: var(--wood);
        }

        .wuxing-item.water {
            border-color: var(--water);
        }

        .wuxing-item.earth {
            border-color: var(--earth);
        }

        .wuxing-icon {
            font-size: 3rem;
            margin-bottom: 10px;
            filter: drop-shadow(0 0 10px currentColor);
        }

        .wuxing-label {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px currentColor;
        }

        .wuxing-percentage {
            font-size: 2rem;
            font-weight: bold;
            text-shadow: 0 0 10px currentColor;
        }

        .wuxing-bar-container {
            margin-top: 15px;
            height: 10px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 5px;
            overflow: hidden;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .wuxing-bar-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 0.8s ease;
            box-shadow: 0 0 15px currentColor;
            animation: pulse-glow 2s ease-in-out infinite;
        }

        @keyframes pulse-glow {
            0%, 100% {
                box-shadow: 0 0 15px currentColor;
            }
            50% {
                box-shadow: 0 0 25px currentColor;
            }
        }

        /* åŠ è½½çŠ¶æ€ - èµ›åšæœ‹å…‹åŠ¨ç”» */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .loading::after {
            content: '...';
            animation: loading-dots 1.5s infinite;
        }

        @keyframes loading-dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        /* é”™è¯¯çŠ¶æ€ */
        .error {
            text-align: center;
            padding: 40px;
            color: var(--fire);
            border: 1px solid var(--fire);
            border-radius: 4px;
            background: rgba(255, 46, 99, 0.1);
            box-shadow: 0 0 20px rgba(255, 46, 99, 0.3);
        }

        /* ç©ºçŠ¶æ€ */
        .empty {
            text-align: center;
            padding: 40px;
            color: var(--text-dim);
        }

        /* é¡µè„š */
        footer {
            text-align: center;
            margin-top: 50px;
            padding: 30px 0;
            border-top: 2px solid var(--neon-blue);
            box-shadow: 0 -2px 20px rgba(0, 243, 255, 0.3);
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        footer a {
            color: var(--neon-blue);
            text-decoration: none;
            transition: all 0.3s ease;
        }

        footer a:hover {
            text-shadow: 0 0 10px var(--neon-blue);
        }

        /* æ»šåŠ¨æ¡ç¾åŒ– */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-darker);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--neon-blue);
            border-radius: 5px;
            box-shadow: 0 0 10px var(--neon-blue);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--neon-purple);
            box-shadow: 0 0 15px var(--neon-purple);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <header>
            <h1>// HYPERCOLLAB_2077</h1>
            <div class="subtitle">è¶…åä½“ Â· äººæœºååŒåä½œä¸­æ¢</div>
            <div class="status-bar">
                <div class="status-item">
                    <span class="status-dot status-healthy"></span>
                    <span>ç³»ç»ŸçŠ¶æ€: <span id="system-status">ONLINE</span></span>
                </div>
                <div class="status-item">
                    <span>æœåŠ¡å™¨: <span id="server-url">LOADING...</span></span>
                </div>
                <div class="status-item">
                    <span>æœ€ååŒæ­¥: <span id="last-sync">--:--:--</span></span>
                </div>
            </div>
        </header>

        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">// TOTAL_MEMBERS</div>
                <div class="stat-value" id="stat-members">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">// ACTIVE_TASKS</div>
                <div class="stat-value" id="stat-active-tasks">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">// COMPLETED</div>
                <div class="stat-value" id="stat-completed">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">// PROGRESS_AVG</div>
                <div class="stat-value" id="stat-progress">0%</div>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-grid">
            <!-- å›¢é˜Ÿæˆå‘˜ -->
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">// TEAM_MEMBERS</div>
                    <div class="panel-badge" id="members-count">0</div>
                </div>
                <div id="members-list">
                    <div class="loading">åŠ è½½å›¢é˜Ÿæˆå‘˜æ•°æ®</div>
                </div>
            </div>

            <!-- åä½œä»»åŠ¡ -->
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">// ACTIVE_TASKS</div>
                    <div class="panel-badge" id="tasks-count">0</div>
                </div>
                <div id="tasks-list">
                    <div class="loading">åŠ è½½ä»»åŠ¡æ•°æ®</div>
                </div>
            </div>
        </div>

        <!-- äº”è¡Œèƒ½é‡å¹³è¡¡ -->
        <div class="panel wuxing-balance">
            <div class="panel-header">
                <div class="panel-title">// WUXING_ENERGY_BALANCE</div>
            </div>
            <div class="wuxing-grid" id="wuxing-grid">
                <div class="loading">åŠ è½½äº”è¡Œèƒ½é‡æ•°æ®</div>
            </div>
        </div>

        <!-- é¡µè„š -->
        <footer>
            <p>HYPERCOLLAB_2077 // è¶…åä½“äººæœºååŒåä½œä¸­æ¢</p>
            <p>Powered by <a href="https://github.com/anthropics/claude-code" target="_blank">Claude Code</a> & MCP Protocol</p>
            <p style="margin-top: 10px; font-size: 0.8rem; color: var(--text-dim);">
                è‡ªåŠ¨åˆ·æ–°é—´éš”: 30ç§’ | äº”è¡Œé£è½®: è¿è½¬ä¸­
            </p>
        </footer>
    </div>

    <script>
        const API_BASE = window.location.origin;

        // è°ƒç”¨MCPå·¥å…·
        async function callMCPTool(toolName, args = {}) {
            try {
                const response = await fetch(`${API_BASE}/mcp/tools/call`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: toolName, arguments: args })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                return JSON.parse(data.content[0].text);
            } catch (error) {
                console.error(`[MCPè°ƒç”¨å¤±è´¥] ${toolName}:`, error);
                throw error;
            }
        }

        // äº”è¡Œé¢œè‰²æ˜ å°„
        const wuxingColors = {
            'ç«': 'var(--fire)',
            'é‡‘': 'var(--metal)',
            'æœ¨': 'var(--wood)',
            'æ°´': 'var(--water)',
            'åœŸ': 'var(--earth)'
        };

        const wuxingIcons = {
            'ç«': 'ğŸ”¥',
            'é‡‘': 'âš™ï¸',
            'æœ¨': 'ğŸŒ³',
            'æ°´': 'ğŸŒŠ',
            'åœŸ': 'ğŸ”ï¸'
        };

        const wuxingClasses = {
            'ç«': 'fire',
            'é‡‘': 'metal',
            'æœ¨': 'wood',
            'æ°´': 'water',
            'åœŸ': 'earth'
        };

        // æ¸²æŸ“å›¢é˜Ÿæˆå‘˜
        function renderMembers(members) {
            const container = document.getElementById('members-list');
            const countBadge = document.getElementById('members-count');

            if (!members || members.length === 0) {
                container.innerHTML = '<div class="empty">æš‚æ— æˆå‘˜æ•°æ®</div>';
                countBadge.textContent = '0';
                return;
            }

            countBadge.textContent = members.length;

            container.innerHTML = members.map(m => {
                const taskCount = m.task_count || 0;
                const profile = m.wuxing_profile || { ç«: 20, é‡‘: 20, æœ¨: 20, æ°´: 20, åœŸ: 20 };

                const wuxingBars = Object.entries(profile)
                    .map(([key, value]) => `
                        <div class="wuxing-segment"
                             style="flex: ${value}; background: ${wuxingColors[key]}; box-shadow: 0 0 10px ${wuxingColors[key]};"
                             title="${key}: ${value}%">
                        </div>
                    `).join('');

                const skillTags = (m.skills || []).slice(0, 3).map(skill =>
                    `<span class="skill-tag">${skill}</span>`
                ).join('');

                return `
                    <div class="member-card">
                        <div class="member-name">${m.name}</div>
                        <div class="skills">${skillTags || '<span class="skill-tag">æš‚æ— æŠ€èƒ½</span>'}</div>
                        <div style="color: var(--text-secondary); font-size: 0.85rem;">
                            å½“å‰è´Ÿè½½: ${taskCount} ä¸ªä»»åŠ¡
                        </div>
                        <div class="wuxing-bar">${wuxingBars}</div>
                    </div>
                `;
            }).join('');
        }

        // æ¸²æŸ“ä»»åŠ¡åˆ—è¡¨
        function renderTasks(tasks) {
            const container = document.getElementById('tasks-list');
            const countBadge = document.getElementById('tasks-count');

            if (!tasks || tasks.length === 0) {
                container.innerHTML = '<div class="empty">æš‚æ— ä»»åŠ¡æ•°æ®</div>';
                countBadge.textContent = '0';
                return;
            }

            // åªæ˜¾ç¤ºæœªå®Œæˆçš„ä»»åŠ¡
            const activeTasks = tasks.filter(t => t.status !== 'completed');
            countBadge.textContent = activeTasks.length;

            if (activeTasks.length === 0) {
                container.innerHTML = '<div class="empty">ğŸ‰ æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆï¼</div>';
                return;
            }

            container.innerHTML = activeTasks.map(t => {
                const progress = t.progress || 0;
                const wuxingColor = wuxingColors[t.wuxing] || 'var(--text-dim)';

                return `
                    <div class="task-card">
                        <div class="task-title">${t.title}</div>
                        <div class="task-meta">
                            <span class="status-badge status-${t.status}">${t.status}</span>
                            <span class="priority-badge priority-${t.priority}">P${t.priority}</span>
                            ${t.wuxing ? `<span style="color: ${wuxingColor};">${wuxingIcons[t.wuxing]} ${t.wuxing}</span>` : ''}
                            <span>ğŸ‘¤ ${t.assigned_to_name || 'æœªåˆ†é…'}</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progress}%"></div>
                        </div>
                        <div style="text-align: right; margin-top: 5px; font-size: 0.8rem; color: var(--text-secondary);">
                            ${progress}%
                        </div>
                    </div>
                `;
            }).join('');
        }

        // æ¸²æŸ“äº”è¡Œèƒ½é‡å¹³è¡¡
        function renderWuxingBalance(tasks) {
            const container = document.getElementById('wuxing-grid');

            if (!tasks || tasks.length === 0) {
                container.innerHTML = '<div class="empty">æš‚æ— äº”è¡Œæ•°æ®</div>';
                return;
            }

            // è®¡ç®—äº”è¡Œåˆ†å¸ƒ
            const distribution = { ç«: 0, é‡‘: 0, æœ¨: 0, æ°´: 0, åœŸ: 0 };
            tasks.forEach(t => {
                if (t.wuxing && t.status !== 'completed') {
                    distribution[t.wuxing]++;
                }
            });

            const total = Object.values(distribution).reduce((a, b) => a + b, 0);

            container.innerHTML = Object.entries(distribution).map(([key, count]) => {
                const percentage = total > 0 ? Math.round((count / total) * 100) : 0;
                const color = wuxingColors[key];
                const wuxingClass = wuxingClasses[key];

                return `
                    <div class="wuxing-item ${wuxingClass}" style="color: ${color};">
                        <div class="wuxing-icon">${wuxingIcons[key]}</div>
                        <div class="wuxing-label">${key}</div>
                        <div class="wuxing-percentage">${percentage}%</div>
                        <div class="wuxing-bar-container">
                            <div class="wuxing-bar-fill" style="width: ${percentage}%; background: ${color};"></div>
                        </div>
                        <div style="margin-top: 10px; font-size: 0.9rem; color: var(--text-secondary);">
                            ${count} ä¸ªä»»åŠ¡
                        </div>
                    </div>
                `;
            }).join('');
        }

        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStats(members, tasks) {
            const activeTasks = tasks.filter(t => t.status !== 'completed');
            const completedTasks = tasks.filter(t => t.status === 'completed');
            const avgProgress = tasks.length > 0
                ? Math.round(tasks.reduce((sum, t) => sum + (t.progress || 0), 0) / tasks.length)
                : 0;

            document.getElementById('stat-members').textContent = members.length;
            document.getElementById('stat-active-tasks').textContent = activeTasks.length;
            document.getElementById('stat-completed').textContent = completedTasks.length;
            document.getElementById('stat-progress').textContent = avgProgress + '%';
        }

        // åŠ è½½æ‰€æœ‰æ•°æ®
        async function loadDashboard() {
            try {
                // å¹¶è¡ŒåŠ è½½æ•°æ®
                const [membersData, tasksData] = await Promise.all([
                    callMCPTool('list_all_members'),
                    callMCPTool('list_all_tasks', { status: 'all' })
                ]);

                const members = membersData.members || [];
                const tasks = tasksData.tasks || [];

                renderMembers(members);
                renderTasks(tasks);
                renderWuxingBalance(tasks);
                updateStats(members, tasks);

                // æ›´æ–°çŠ¶æ€æ 
                document.getElementById('system-status').textContent = 'ONLINE';
                document.getElementById('server-url').textContent = API_BASE;
                document.getElementById('last-sync').textContent = new Date().toLocaleTimeString('zh-CN');

            } catch (error) {
                console.error('[ä»ªè¡¨ç›˜åŠ è½½å¤±è´¥]', error);
                document.getElementById('members-list').innerHTML =
                    `<div class="error">âš ï¸ åŠ è½½å¤±è´¥: ${error.message}</div>`;
                document.getElementById('tasks-list').innerHTML =
                    `<div class="error">âš ï¸ åŠ è½½å¤±è´¥: ${error.message}</div>`;
                document.getElementById('system-status').textContent = 'ERROR';
            }
        }

        // åˆå§‹åŠ è½½
        loadDashboard();

        // è‡ªåŠ¨åˆ·æ–° (30ç§’)
        setInterval(loadDashboard, 30000);

        console.log('%c// HYPERCOLLAB_2077', 'color: #00f3ff; font-size: 20px; font-weight: bold; text-shadow: 0 0 10px #00f3ff;');
        console.log('%cè¶…åä½“åä½œä¸­æ¢å·²å¯åŠ¨', 'color: #ff2e97; font-size: 14px;');
        console.log('%cäº”è¡Œé£è½®è¿è½¬ä¸­...', 'color: #b537f2; font-size: 14px;');
    </script>
</body>
</html>
